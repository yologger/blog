<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes 오브젝트 | Yologger&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/blog/favicon.ico">
    <meta name="description" content="yologger&#39;s blog">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/blog/assets/css/0.styles.0e080af6.css" as="style"><link rel="preload" href="/blog/assets/js/app.32362dc0.js" as="script"><link rel="preload" href="/blog/assets/js/3.8795c9a2.js" as="script"><link rel="preload" href="/blog/assets/js/60.affca2b3.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.009f8593.js"><link rel="prefetch" href="/blog/assets/js/100.04c8c108.js"><link rel="prefetch" href="/blog/assets/js/101.02907c78.js"><link rel="prefetch" href="/blog/assets/js/102.34e5043e.js"><link rel="prefetch" href="/blog/assets/js/103.9f91abc2.js"><link rel="prefetch" href="/blog/assets/js/104.31f63255.js"><link rel="prefetch" href="/blog/assets/js/105.8a43c1db.js"><link rel="prefetch" href="/blog/assets/js/106.b9460ed3.js"><link rel="prefetch" href="/blog/assets/js/107.f8cdc232.js"><link rel="prefetch" href="/blog/assets/js/108.8978a1ba.js"><link rel="prefetch" href="/blog/assets/js/109.968539f7.js"><link rel="prefetch" href="/blog/assets/js/11.70d9a8f5.js"><link rel="prefetch" href="/blog/assets/js/110.ad77dfe5.js"><link rel="prefetch" href="/blog/assets/js/111.a3e57423.js"><link rel="prefetch" href="/blog/assets/js/112.87034314.js"><link rel="prefetch" href="/blog/assets/js/113.2fcf2309.js"><link rel="prefetch" href="/blog/assets/js/114.8fed71aa.js"><link rel="prefetch" href="/blog/assets/js/115.a4990a06.js"><link rel="prefetch" href="/blog/assets/js/116.1780fd7a.js"><link rel="prefetch" href="/blog/assets/js/117.f22668d4.js"><link rel="prefetch" href="/blog/assets/js/118.bbe27d51.js"><link rel="prefetch" href="/blog/assets/js/119.25b9b643.js"><link rel="prefetch" href="/blog/assets/js/12.31f8420a.js"><link rel="prefetch" href="/blog/assets/js/120.9d9f48f0.js"><link rel="prefetch" href="/blog/assets/js/121.40af3a0c.js"><link rel="prefetch" href="/blog/assets/js/122.a636d2ef.js"><link rel="prefetch" href="/blog/assets/js/123.5c99f4f4.js"><link rel="prefetch" href="/blog/assets/js/124.3e75231d.js"><link rel="prefetch" href="/blog/assets/js/125.7cf1f005.js"><link rel="prefetch" href="/blog/assets/js/126.86bd0915.js"><link rel="prefetch" href="/blog/assets/js/127.34dfb59d.js"><link rel="prefetch" href="/blog/assets/js/128.cb8753b6.js"><link rel="prefetch" href="/blog/assets/js/129.75f1821b.js"><link rel="prefetch" href="/blog/assets/js/13.d86b1ae2.js"><link rel="prefetch" href="/blog/assets/js/130.352fa799.js"><link rel="prefetch" href="/blog/assets/js/131.57a5cee5.js"><link rel="prefetch" href="/blog/assets/js/132.b774b3fe.js"><link rel="prefetch" href="/blog/assets/js/133.5cea1190.js"><link rel="prefetch" href="/blog/assets/js/134.dbc3bbbd.js"><link rel="prefetch" href="/blog/assets/js/135.02ff9368.js"><link rel="prefetch" href="/blog/assets/js/136.f7128a40.js"><link rel="prefetch" href="/blog/assets/js/137.a3c425d9.js"><link rel="prefetch" href="/blog/assets/js/138.187b1e7e.js"><link rel="prefetch" href="/blog/assets/js/139.d581d7f6.js"><link rel="prefetch" href="/blog/assets/js/14.78cdbe3d.js"><link rel="prefetch" href="/blog/assets/js/140.1947f6c2.js"><link rel="prefetch" href="/blog/assets/js/141.d2397ceb.js"><link rel="prefetch" href="/blog/assets/js/142.a4fca10f.js"><link rel="prefetch" href="/blog/assets/js/143.868445e7.js"><link rel="prefetch" href="/blog/assets/js/144.a1c80310.js"><link rel="prefetch" href="/blog/assets/js/145.319913ba.js"><link rel="prefetch" href="/blog/assets/js/146.d19fd28e.js"><link rel="prefetch" href="/blog/assets/js/147.0f7acde4.js"><link rel="prefetch" href="/blog/assets/js/148.945a5b62.js"><link rel="prefetch" href="/blog/assets/js/149.eb4bec1b.js"><link rel="prefetch" href="/blog/assets/js/15.c479e5b5.js"><link rel="prefetch" href="/blog/assets/js/150.50892fe5.js"><link rel="prefetch" href="/blog/assets/js/151.c675ddff.js"><link rel="prefetch" href="/blog/assets/js/152.05d1ee8a.js"><link rel="prefetch" href="/blog/assets/js/153.75510d20.js"><link rel="prefetch" href="/blog/assets/js/154.f579d477.js"><link rel="prefetch" href="/blog/assets/js/155.12dbf578.js"><link rel="prefetch" href="/blog/assets/js/156.af8b54dd.js"><link rel="prefetch" href="/blog/assets/js/157.02eb87f5.js"><link rel="prefetch" href="/blog/assets/js/158.a1fbd08d.js"><link rel="prefetch" href="/blog/assets/js/159.75594bb8.js"><link rel="prefetch" href="/blog/assets/js/16.aec21ad3.js"><link rel="prefetch" href="/blog/assets/js/160.4eb83312.js"><link rel="prefetch" href="/blog/assets/js/161.104311e5.js"><link rel="prefetch" href="/blog/assets/js/162.aabbb479.js"><link rel="prefetch" href="/blog/assets/js/163.bf862198.js"><link rel="prefetch" href="/blog/assets/js/164.73e0e8e9.js"><link rel="prefetch" href="/blog/assets/js/165.052c0123.js"><link rel="prefetch" href="/blog/assets/js/166.f5eb35cc.js"><link rel="prefetch" href="/blog/assets/js/167.7a313045.js"><link rel="prefetch" href="/blog/assets/js/168.86fb56fe.js"><link rel="prefetch" href="/blog/assets/js/169.df883b7e.js"><link rel="prefetch" href="/blog/assets/js/17.3a9b6735.js"><link rel="prefetch" href="/blog/assets/js/170.47f0dbf7.js"><link rel="prefetch" href="/blog/assets/js/171.aec0020e.js"><link rel="prefetch" href="/blog/assets/js/172.c1d8c91b.js"><link rel="prefetch" href="/blog/assets/js/173.a6f2fcd6.js"><link rel="prefetch" href="/blog/assets/js/174.38b52e5e.js"><link rel="prefetch" href="/blog/assets/js/175.ae38f488.js"><link rel="prefetch" href="/blog/assets/js/176.29adebfe.js"><link rel="prefetch" href="/blog/assets/js/177.41b97ad0.js"><link rel="prefetch" href="/blog/assets/js/178.0fa9bbf3.js"><link rel="prefetch" href="/blog/assets/js/179.8559c981.js"><link rel="prefetch" href="/blog/assets/js/18.0c383095.js"><link rel="prefetch" href="/blog/assets/js/180.8733c320.js"><link rel="prefetch" href="/blog/assets/js/181.21e0e018.js"><link rel="prefetch" href="/blog/assets/js/182.b6e485e9.js"><link rel="prefetch" href="/blog/assets/js/183.c27d150d.js"><link rel="prefetch" href="/blog/assets/js/184.0fbcb691.js"><link rel="prefetch" href="/blog/assets/js/185.7e650b04.js"><link rel="prefetch" href="/blog/assets/js/186.6657fe1d.js"><link rel="prefetch" href="/blog/assets/js/187.551c064a.js"><link rel="prefetch" href="/blog/assets/js/188.8ba6e40b.js"><link rel="prefetch" href="/blog/assets/js/189.041316b7.js"><link rel="prefetch" href="/blog/assets/js/19.750739bf.js"><link rel="prefetch" href="/blog/assets/js/190.d71b0917.js"><link rel="prefetch" href="/blog/assets/js/191.a7d8bb61.js"><link rel="prefetch" href="/blog/assets/js/192.5fce8db9.js"><link rel="prefetch" href="/blog/assets/js/193.c5cc9ffb.js"><link rel="prefetch" href="/blog/assets/js/194.a63b6260.js"><link rel="prefetch" href="/blog/assets/js/195.d2e09806.js"><link rel="prefetch" href="/blog/assets/js/196.063ba68f.js"><link rel="prefetch" href="/blog/assets/js/197.d39d3324.js"><link rel="prefetch" href="/blog/assets/js/198.ce84b47e.js"><link rel="prefetch" href="/blog/assets/js/199.93c36c7f.js"><link rel="prefetch" href="/blog/assets/js/2.b088ac97.js"><link rel="prefetch" href="/blog/assets/js/20.13aea874.js"><link rel="prefetch" href="/blog/assets/js/200.48855557.js"><link rel="prefetch" href="/blog/assets/js/201.af6c3d13.js"><link rel="prefetch" href="/blog/assets/js/202.355fa950.js"><link rel="prefetch" href="/blog/assets/js/203.8b9a3978.js"><link rel="prefetch" href="/blog/assets/js/204.9d334517.js"><link rel="prefetch" href="/blog/assets/js/205.9d4d72ca.js"><link rel="prefetch" href="/blog/assets/js/206.2734a14e.js"><link rel="prefetch" href="/blog/assets/js/207.856430a2.js"><link rel="prefetch" href="/blog/assets/js/208.553763b5.js"><link rel="prefetch" href="/blog/assets/js/209.39f55833.js"><link rel="prefetch" href="/blog/assets/js/21.b5875938.js"><link rel="prefetch" href="/blog/assets/js/210.5c7be277.js"><link rel="prefetch" href="/blog/assets/js/211.8d787e7d.js"><link rel="prefetch" href="/blog/assets/js/212.97822173.js"><link rel="prefetch" href="/blog/assets/js/213.26729f1a.js"><link rel="prefetch" href="/blog/assets/js/214.7c6fd838.js"><link rel="prefetch" href="/blog/assets/js/215.ffa3d1cb.js"><link rel="prefetch" href="/blog/assets/js/216.5d2ebcf4.js"><link rel="prefetch" href="/blog/assets/js/217.17f13f17.js"><link rel="prefetch" href="/blog/assets/js/218.4209a714.js"><link rel="prefetch" href="/blog/assets/js/219.e1b478d8.js"><link rel="prefetch" href="/blog/assets/js/22.265c8215.js"><link rel="prefetch" href="/blog/assets/js/220.86c2079c.js"><link rel="prefetch" href="/blog/assets/js/221.1c717f8b.js"><link rel="prefetch" href="/blog/assets/js/222.585d0104.js"><link rel="prefetch" href="/blog/assets/js/223.29fc7e37.js"><link rel="prefetch" href="/blog/assets/js/224.d5e24637.js"><link rel="prefetch" href="/blog/assets/js/225.df1946ac.js"><link rel="prefetch" href="/blog/assets/js/226.2aa1c4d7.js"><link rel="prefetch" href="/blog/assets/js/227.a751e31d.js"><link rel="prefetch" href="/blog/assets/js/228.6e330b47.js"><link rel="prefetch" href="/blog/assets/js/229.77229d7b.js"><link rel="prefetch" href="/blog/assets/js/23.c83da651.js"><link rel="prefetch" href="/blog/assets/js/230.062a5ac1.js"><link rel="prefetch" href="/blog/assets/js/231.87bbf70b.js"><link rel="prefetch" href="/blog/assets/js/232.31af7ed9.js"><link rel="prefetch" href="/blog/assets/js/233.b1a58839.js"><link rel="prefetch" href="/blog/assets/js/234.68cec967.js"><link rel="prefetch" href="/blog/assets/js/235.ea62ee88.js"><link rel="prefetch" href="/blog/assets/js/236.a2f2b050.js"><link rel="prefetch" href="/blog/assets/js/237.e7cad44f.js"><link rel="prefetch" href="/blog/assets/js/238.81b4b5a3.js"><link rel="prefetch" href="/blog/assets/js/239.1c862178.js"><link rel="prefetch" href="/blog/assets/js/24.421a250c.js"><link rel="prefetch" href="/blog/assets/js/240.18b5df51.js"><link rel="prefetch" href="/blog/assets/js/241.aa077fb6.js"><link rel="prefetch" href="/blog/assets/js/242.c63afd4d.js"><link rel="prefetch" href="/blog/assets/js/243.b2129f8c.js"><link rel="prefetch" href="/blog/assets/js/244.ff8e7a30.js"><link rel="prefetch" href="/blog/assets/js/245.88169faa.js"><link rel="prefetch" href="/blog/assets/js/246.fa9199da.js"><link rel="prefetch" href="/blog/assets/js/247.cdd33986.js"><link rel="prefetch" href="/blog/assets/js/248.765f4cb5.js"><link rel="prefetch" href="/blog/assets/js/249.2a26a296.js"><link rel="prefetch" href="/blog/assets/js/25.154520e5.js"><link rel="prefetch" href="/blog/assets/js/250.439fb16a.js"><link rel="prefetch" href="/blog/assets/js/251.e057e7e0.js"><link rel="prefetch" href="/blog/assets/js/252.34794853.js"><link rel="prefetch" href="/blog/assets/js/253.c622fcbd.js"><link rel="prefetch" href="/blog/assets/js/254.74a70b9f.js"><link rel="prefetch" href="/blog/assets/js/255.fed47ff6.js"><link rel="prefetch" href="/blog/assets/js/256.a88005ca.js"><link rel="prefetch" href="/blog/assets/js/257.11083964.js"><link rel="prefetch" href="/blog/assets/js/258.0b1a7d73.js"><link rel="prefetch" href="/blog/assets/js/259.62c584ff.js"><link rel="prefetch" href="/blog/assets/js/26.4a88bf4d.js"><link rel="prefetch" href="/blog/assets/js/260.1063ea57.js"><link rel="prefetch" href="/blog/assets/js/261.8f065193.js"><link rel="prefetch" href="/blog/assets/js/262.f796ed15.js"><link rel="prefetch" href="/blog/assets/js/263.38c3508c.js"><link rel="prefetch" href="/blog/assets/js/264.6a5fb90f.js"><link rel="prefetch" href="/blog/assets/js/265.79985a16.js"><link rel="prefetch" href="/blog/assets/js/266.58737293.js"><link rel="prefetch" href="/blog/assets/js/267.c0489be8.js"><link rel="prefetch" href="/blog/assets/js/268.9b482a12.js"><link rel="prefetch" href="/blog/assets/js/269.d807798b.js"><link rel="prefetch" href="/blog/assets/js/27.7f6c507f.js"><link rel="prefetch" href="/blog/assets/js/270.62e46aaf.js"><link rel="prefetch" href="/blog/assets/js/271.a2636662.js"><link rel="prefetch" href="/blog/assets/js/272.2c029ac2.js"><link rel="prefetch" href="/blog/assets/js/273.c0803a3e.js"><link rel="prefetch" href="/blog/assets/js/274.feed5dcb.js"><link rel="prefetch" href="/blog/assets/js/275.d026e4d0.js"><link rel="prefetch" href="/blog/assets/js/276.6348ed02.js"><link rel="prefetch" href="/blog/assets/js/277.cb5be1e0.js"><link rel="prefetch" href="/blog/assets/js/28.86691d04.js"><link rel="prefetch" href="/blog/assets/js/29.34f07073.js"><link rel="prefetch" href="/blog/assets/js/30.c7caa137.js"><link rel="prefetch" href="/blog/assets/js/31.07b08573.js"><link rel="prefetch" href="/blog/assets/js/32.2d17c55c.js"><link rel="prefetch" href="/blog/assets/js/33.34659507.js"><link rel="prefetch" href="/blog/assets/js/34.ca823a5d.js"><link rel="prefetch" href="/blog/assets/js/35.fdee0018.js"><link rel="prefetch" href="/blog/assets/js/36.1df26e75.js"><link rel="prefetch" href="/blog/assets/js/37.e84c6798.js"><link rel="prefetch" href="/blog/assets/js/38.0ab020a7.js"><link rel="prefetch" href="/blog/assets/js/39.c752cd4a.js"><link rel="prefetch" href="/blog/assets/js/4.dce05cd8.js"><link rel="prefetch" href="/blog/assets/js/40.e6ff46a5.js"><link rel="prefetch" href="/blog/assets/js/41.7b5ace1e.js"><link rel="prefetch" href="/blog/assets/js/42.bd14936e.js"><link rel="prefetch" href="/blog/assets/js/43.d12fece7.js"><link rel="prefetch" href="/blog/assets/js/44.6fca8fd5.js"><link rel="prefetch" href="/blog/assets/js/45.907b4f15.js"><link rel="prefetch" href="/blog/assets/js/46.f9d2e206.js"><link rel="prefetch" href="/blog/assets/js/47.b1653fc1.js"><link rel="prefetch" href="/blog/assets/js/48.99b3c7bb.js"><link rel="prefetch" href="/blog/assets/js/49.828907da.js"><link rel="prefetch" href="/blog/assets/js/5.7193cd84.js"><link rel="prefetch" href="/blog/assets/js/50.f51f2a3e.js"><link rel="prefetch" href="/blog/assets/js/51.29a6e8ea.js"><link rel="prefetch" href="/blog/assets/js/52.4d64b497.js"><link rel="prefetch" href="/blog/assets/js/53.12dca8e6.js"><link rel="prefetch" href="/blog/assets/js/54.e3c4fef4.js"><link rel="prefetch" href="/blog/assets/js/55.b801643c.js"><link rel="prefetch" href="/blog/assets/js/56.a3d351a1.js"><link rel="prefetch" href="/blog/assets/js/57.cfabc431.js"><link rel="prefetch" href="/blog/assets/js/58.8a3cbbf5.js"><link rel="prefetch" href="/blog/assets/js/59.a5a7464b.js"><link rel="prefetch" href="/blog/assets/js/6.98f083fd.js"><link rel="prefetch" href="/blog/assets/js/61.adf43eb0.js"><link rel="prefetch" href="/blog/assets/js/62.480ff614.js"><link rel="prefetch" href="/blog/assets/js/63.725f57dc.js"><link rel="prefetch" href="/blog/assets/js/64.ee3ea45f.js"><link rel="prefetch" href="/blog/assets/js/65.a9874219.js"><link rel="prefetch" href="/blog/assets/js/66.ec0c5b17.js"><link rel="prefetch" href="/blog/assets/js/67.043a2f09.js"><link rel="prefetch" href="/blog/assets/js/68.c85cdc1a.js"><link rel="prefetch" href="/blog/assets/js/69.24eb94a2.js"><link rel="prefetch" href="/blog/assets/js/7.a3939503.js"><link rel="prefetch" href="/blog/assets/js/70.7ab8f348.js"><link rel="prefetch" href="/blog/assets/js/71.3f967059.js"><link rel="prefetch" href="/blog/assets/js/72.296c112d.js"><link rel="prefetch" href="/blog/assets/js/73.4bad88aa.js"><link rel="prefetch" href="/blog/assets/js/74.ad674c4d.js"><link rel="prefetch" href="/blog/assets/js/75.6e3c3e6d.js"><link rel="prefetch" href="/blog/assets/js/76.e027ccc7.js"><link rel="prefetch" href="/blog/assets/js/77.963c60ef.js"><link rel="prefetch" href="/blog/assets/js/78.b6ecfd1c.js"><link rel="prefetch" href="/blog/assets/js/79.5c540919.js"><link rel="prefetch" href="/blog/assets/js/8.af2847e2.js"><link rel="prefetch" href="/blog/assets/js/80.cb971025.js"><link rel="prefetch" href="/blog/assets/js/81.8fea14a9.js"><link rel="prefetch" href="/blog/assets/js/82.e177062a.js"><link rel="prefetch" href="/blog/assets/js/83.c89e463b.js"><link rel="prefetch" href="/blog/assets/js/84.89d68e32.js"><link rel="prefetch" href="/blog/assets/js/85.12901aa6.js"><link rel="prefetch" href="/blog/assets/js/86.f7b120e4.js"><link rel="prefetch" href="/blog/assets/js/87.a620f73f.js"><link rel="prefetch" href="/blog/assets/js/88.aef154fa.js"><link rel="prefetch" href="/blog/assets/js/89.9f71412f.js"><link rel="prefetch" href="/blog/assets/js/9.820df2c6.js"><link rel="prefetch" href="/blog/assets/js/90.dd797eb4.js"><link rel="prefetch" href="/blog/assets/js/91.2f4cee08.js"><link rel="prefetch" href="/blog/assets/js/92.fcbd90d3.js"><link rel="prefetch" href="/blog/assets/js/93.49088527.js"><link rel="prefetch" href="/blog/assets/js/94.2162a1ba.js"><link rel="prefetch" href="/blog/assets/js/95.69c4c5ba.js"><link rel="prefetch" href="/blog/assets/js/96.70c77a1a.js"><link rel="prefetch" href="/blog/assets/js/97.77ecde0a.js"><link rel="prefetch" href="/blog/assets/js/98.bdec1ab1.js"><link rel="prefetch" href="/blog/assets/js/99.928b66ab.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.0e080af6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.jpg" alt="Yologger's Blog" class="logo"> <span class="site-name can-hide">Yologger's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/post/01_java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/blog/post/02_kotlin/" class="nav-link">
  Kotlin
</a></div><div class="nav-item"><a href="/blog/post/30_spring/" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/blog/post/20_android/" class="nav-link">
  Android
</a></div><div class="nav-item"><a href="/blog/post/50_infra_devops/" class="nav-link router-link-active">
  Infra/DevOps
</a></div><div class="nav-item"><a href="/blog/post/55_db/" class="nav-link">
  DB
</a></div><div class="nav-item"><a href="/blog/post/60_cs/" class="nav-link">
  CS
</a></div><div class="nav-item"><a href="/blog/post/80_more/" class="nav-link">
  More
</a></div><div class="nav-item"><a href="https://github.com/yologger" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/post/01_java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/blog/post/02_kotlin/" class="nav-link">
  Kotlin
</a></div><div class="nav-item"><a href="/blog/post/30_spring/" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/blog/post/20_android/" class="nav-link">
  Android
</a></div><div class="nav-item"><a href="/blog/post/50_infra_devops/" class="nav-link router-link-active">
  Infra/DevOps
</a></div><div class="nav-item"><a href="/blog/post/55_db/" class="nav-link">
  DB
</a></div><div class="nav-item"><a href="/blog/post/60_cs/" class="nav-link">
  CS
</a></div><div class="nav-item"><a href="/blog/post/80_more/" class="nav-link">
  More
</a></div><div class="nav-item"><a href="https://github.com/yologger" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/post/50_infra_devops/" aria-current="page" class="sidebar-link">Introduction</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git, GitHub</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Kubernetes</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/post/50_infra_devops/54_Kubernetes/220101_start_kubernetes.html" class="sidebar-link">Kubernetes 시작하기</a></li><li><a href="/blog/post/50_infra_devops/54_Kubernetes/220103_kubernetes_objects.html" aria-current="page" class="active sidebar-link">Kubernetes 오브젝트</a></li><li><a href="/blog/post/50_infra_devops/54_Kubernetes/220104_kubernetes_command.html" class="sidebar-link">Kubernetes 명령어 정리</a></li><li><a href="/blog/post/50_infra_devops/54_Kubernetes/220105_spring_with_docker.html" class="sidebar-link">Dockerize Springboot &amp; Deploy to Kubernetes</a></li><li><a href="/blog/post/50_infra_devops/54_Kubernetes/220106_kubernetes_argo.html" class="sidebar-link">Github Actions + Argo CD 으로 Kubernetes CI/CD 파이프라인 구축하기</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="table-of-contents"><a href="#table-of-contents" class="header-anchor">#</a> Table of Contents</h1> <p></p><div class="table-of-contents"><ul><li><a href="#yaml-configuration-파일">YAML Configuration 파일</a></li><li><a href="#pod">Pod</a><ul><li><a href="#팟-생성-및-실행">팟 생성 및 실행</a></li><li><a href="#오브젝트-목록-확인">오브젝트 목록 확인</a></li><li><a href="#오브젝트-상세정보-확인">오브젝트 상세정보 확인</a></li><li><a href="#컨테이너-내부에-접속하기">컨테이너 내부에 접속하기</a></li><li><a href="#팟-로그-확인하기">팟 로그 확인하기</a></li><li><a href="#팟-삭제">팟 삭제</a></li><li><a href="#모든-팟-삭제">모든 팟 삭제</a></li><li><a href="#pod-vs-docker-container">Pod vs. Docker container</a></li></ul></li><li><a href="#replicaset">ReplicaSet</a></li><li><a href="#deployment">Deployment</a></li><li><a href="#service">Service</a><ul><li><a href="#팟-주소-고정">팟 주소 고정</a></li><li><a href="#팟의-외부-노출">팟의 외부 노출</a></li><li><a href="#clusterip-서비스">ClusterIP 서비스</a></li><li><a href="#nodeport-서비스">NodePort 서비스</a></li></ul></li><li><a href="#namespace">Namespace</a><ul><li><a href="#네임스페이스-목록-확인">네임스페이스 목록 확인</a></li><li><a href="#네임스페이스-생성">네임스페이스 생성</a></li><li><a href="#네임스페이스에-오브젝트-생성하기">네임스페이스에 오브젝트 생성하기</a></li><li><a href="#특정-네임스페이스에-포함되는-오브젝트만-조회하기">특정 네임스페이스에 포함되는 오브젝트만 조회하기</a></li><li><a href="#네임스페이스-삭제">네임스페이스 삭제</a></li></ul></li><li><a href="#configmap">Configmap</a><ul><li><a href="#컨피그맵-생성">컨피그맵 생성</a></li><li><a href="#컨피그맵-확인">컨피그맵 확인</a></li><li><a href="#yaml-설정파일에서-컨피그맵-사용하기">YAML 설정파일에서 컨피그맵 사용하기</a></li><li><a href="#컨피그맵-삭제">컨피그맵 삭제</a></li></ul></li><li><a href="#secret">Secret</a><ul><li><a href="#시크릿-생성">시크릿 생성</a></li><li><a href="#시크릿-확인">시크릿 확인</a></li><li><a href="#yaml-설정파일에서-시크릿-사용하기">YAML 설정파일에서 시크릿 사용하기</a></li><li><a href="#시크릿-삭제">시크릿 삭제</a></li></ul></li><li><a href="#ingress">Ingress</a><ul><li><a href="#세팅">세팅</a></li><li><a href="#인그레스-오브젝트-생성하기">인그레스 오브젝트 생성하기</a></li><li><a href="#인그레스-컨트롤러-설치">인그레스 컨트롤러 설치</a></li></ul></li><li><a href="#kustomize">Kustomize</a><ul><li><a href="#kustomize-설치">Kustomize 설치</a></li><li><a href="#예제-디렉토리-구성하기">예제 디렉토리 구성하기</a></li><li><a href="#템플릿-생성하기">템플릿 생성하기</a></li><li><a href="#개발-환경-커스터마이징">개발 환경 커스터마이징</a></li><li><a href="#운영-환경-커스터마이징">운영 환경 커스터마이징</a></li><li><a href="#이미지-태그-변경하기">이미지 태그 변경하기</a></li><li><a href="#패치-파일-사용하기">패치 파일 사용하기</a></li></ul></li></ul></div><p></p> <h1 id="오브젝트"><a href="#오브젝트" class="header-anchor">#</a> 오브젝트</h1> <p>쿠버네티스는 자원을 <code>오브젝트(Object)</code>라는 형태로 관리한다. 자주 사용하는 오브젝트는 다음과 같다.</p> <ul><li><code>Pod</code></li> <li><code>ReplicaSet</code></li> <li><code>Deployment</code></li> <li><code>Configmap</code></li> <li><code>Secret</code></li> <li><code>Namespace</code></li> <li><code>Service</code></li> <li><code>Ingress</code></li></ul> <p>다음 명령어로 쿠버네티스가 제공하는 모든 오브젝트를 확인할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl api-resources
NAME                              SHORTNAMES   APIVERSION                             NAMESPACED   KIND
pods                              po           v1                                     true         Pod
replicasets                       rs           apps/v1                                true         ReplicaSet
services                          svc          v1                                     true         Service
deployments                       deploy       apps/v1                                true         Deployment
configmaps                        cm           v1                                     true         ConfigMap
secrets                                        v1                                     true         Secret
namespaces                        ns           v1                                     false        Namespace
ingresses                         ing          networking.k8s.io/v1                   true         Ingress
....
</code></pre></div><h2 id="yaml-configuration-파일"><a href="#yaml-configuration-파일" class="header-anchor">#</a> YAML Configuration 파일</h2> <p>쿠버네티스틑 <code>YAML 파일</code>에 오브젝트를 선언하고 설정한다. 그리고 <code>kubectl apply &lt;YAML 파일&gt;</code> 명령어로 클러스터를 실행한다.</p> <h2 id="pod"><a href="#pod" class="header-anchor">#</a> Pod</h2> <ul><li>쿠버네티스에서는 컨테이너 애플리케이션의 기본 단위를 <code>팟(Pod)</code>이라고 한다.</li> <li>팟은 하나 이상의 도커 컨테이너로 구성된다.</li></ul> <p>하나의 Nginx 컨테이너로 구성된 간단한 팟을 생성해보자. 먼저 <code>nginx-pod.yml</code>파일을 다음과 같이 작성한다.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod  <span class="token comment"># Pod 이름</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>  <span class="token comment"># Pod에 생성할 컨테이너 나열</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container  <span class="token comment"># 컨테이너 이름</span>
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest  <span class="token comment"># 컨테이너 이미지</span>
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
</code></pre></div><ul><li><code>kind</code>: 오브젝트 종류</li> <li><code>metadata.name</code>: 팟 이름</li> <li><code>spec</code>: 오브젝트 생성을 위한 상세한 종료</li> <li><code>spec.containers</code>: 팟에 생성할 컨테이너들을 나열한다.</li></ul> <h3 id="팟-생성-및-실행"><a href="#팟-생성-및-실행" class="header-anchor">#</a> 팟 생성 및 실행</h3> <p><code>kubectl apply -f &lt;YAML 파일&gt;</code> 명령어로 클러스터에서 팟을 실행할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl apply -f nginx-pod.yml
pod/nginx-pod created
</code></pre></div><p>하나의 도커 컨테이너가 생성된 것도 확인할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ docker ps -al
ONTAINER ID     IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES
fe068fdc944c    nginx     &quot;/docker-entrypoint.…&quot;   24 seconds ago   Up 24 seconds             k8s_nginx-container_nginx-pod_default_e1574fb9-c59e-4916-8bcc-188a5640f6cd_0
</code></pre></div><p>YAML 파일에 <code>---</code>를 명시하여 여러 오브젝트를 선언할 수 있다. 다음 예제는 두 개의 팟을 선언하고 있다.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span><span class="token number">1</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>  
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span><span class="token number">2</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>  
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
</code></pre></div><h3 id="오브젝트-목록-확인"><a href="#오브젝트-목록-확인" class="header-anchor">#</a> 오브젝트 목록 확인</h3> <p><code>kubectl get &lt;오브젝트 이름&gt;</code> 명령어로 오브젝트 목록을 확인할 수 있다. <code>READY</code>의 <code>1/1</code>은 한 개의 컨테이너 중 한 개의 컨테이너가 정상 실행 중이라는 의미다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods
NAME        READY   STATUS    RESTARTS   AGE
nginx-pod   1/1     Running   0          3m
</code></pre></div><p><code>-o wide</code> 옵션으로 클러스터 내부에서 팟에 할당된 IP도 확인할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods -o wide
NAME        READY   STATUS    RESTARTS   AGE   IP          NODE             NOMINATED NODE   READINESS GATES
nginx-pod   1/1     Running   0          70m   10.1.0.33   docker-desktop   &lt;none&gt;           &lt;none&gt;
</code></pre></div><p><code>kubectl get all</code>명령어로 모든 오브젝트를 조회할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get all
</code></pre></div><h3 id="오브젝트-상세정보-확인"><a href="#오브젝트-상세정보-확인" class="header-anchor">#</a> 오브젝트 상세정보 확인</h3> <p><code>kubectl describe &lt;오브젝트 종류&gt; &lt;오브젝트 이름&gt;</code>으로 오브젝트의 상세한 정보를 확인할 수 있다.</p> <div class="language- extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br></div><pre class="language-text"><code>$ kubectl describe pods nginx-pod    
Name:         nginx-pod
Namespace:    default
Priority:     0
Node:         docker-desktop/192.168.65.4   // 노드 IP
Start Time:   Tue, 19 Apr 2022 14:23:56 +0900
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
Status:       Running
IP:           10.1.0.33   // 팟 IP
IPs:
  IP:  10.1.0.33
Containers:
  nginx-container:
    Container ID:   docker://fe068fdc944c8d64e198c6da83eb29d8f97340412679605c6ba15bda710efe31
    Image:          nginx:latest
    Image ID:       docker-pullable://nginx@sha256:2275af0f20d71b293916f1958f8497f987b8d8fd8113df54635f2a5915002bf1
    Port:           80/TCP
    // 생략 ...
</code></pre></div><h3 id="컨테이너-내부에-접속하기"><a href="#컨테이너-내부에-접속하기" class="header-anchor">#</a> 컨테이너 내부에 접속하기</h3> <p><code>kubectl exec -it &lt;팟 이름&gt; -c &lt;컨테이너 이름&gt; &lt;사용할 쉘&gt;</code>로 팟 내부 컨테이너에 접속할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl exec -it nginx-pod -c nginx-container bash
root@nginx-pod:/# 
</code></pre></div><p><code>Nginx</code>가 실행 중인지 확인해보자.</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl localhost
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><h3 id="팟-로그-확인하기"><a href="#팟-로그-확인하기" class="header-anchor">#</a> 팟 로그 확인하기</h3> <p><code>kubectl logs nginx-pod</code> 명령어로 팟 로그를 확인할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl logs nginx-pod
</code></pre></div><h3 id="팟-삭제"><a href="#팟-삭제" class="header-anchor">#</a> 팟 삭제</h3> <p><code>kubectl delete -f &lt;yml 파일&gt;</code> 명령어로 팟을 삭제할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl delete -f nginx-pod.yml
pod &quot;nginx-pod&quot; deleted
</code></pre></div><h3 id="모든-팟-삭제"><a href="#모든-팟-삭제" class="header-anchor">#</a> 모든 팟 삭제</h3> <p><code>kubectl delete pods --all</code> 명령어로 모든 팟을 삭제할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl delete pods --all 
</code></pre></div><h3 id="pod-vs-docker-container"><a href="#pod-vs-docker-container" class="header-anchor">#</a> Pod vs. Docker container</h3> <p>팟은 여러 컨테이너를 포함할 수도 있다. <code>nginx-pod.yml</code> 파일을 다음과 같이 수정하자.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token comment"># 첫번째 컨테이너</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP

    <span class="token comment"># 두번째 컨테이너</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>container
      <span class="token key atrule">image</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">:</span>latest
      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;tail&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;-f&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/dev/null&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>두 개의 컨테이너가 생성된 것을 확인할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods              
NAME        READY   STATUS    RESTARTS   AGE
nginx-pod   2/2     Running   0          116s
</code></pre></div><h2 id="replicaset"><a href="#replicaset" class="header-anchor">#</a> ReplicaSet</h2> <p><code>레플리카셋(ReplicaSet)</code>은 다음 기능을 제공하는 오브젝트다.</p> <ul><li>동일한 팟 여러 개를 쉽게 생성, 관리할 수 있다.</li> <li>지정한 개수의 팟을 항상 유지하기 때문에 특정 팟이 다운되어도 팟을 새롭게 생성하거나 재시작한다.</li></ul> <p>세 개의 동일한 팟을 유지하는 레플리카셋을 생성해보자. <code>nginx-replicaset.yml</code>을 다음과 같이 작성한다.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-yml"><code><span class="token comment"># nginx-replicaset.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicaSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>replicaset
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span> 
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span> 
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><ul><li><code>spec.replicas</code>: 생성할 팟의 수</li></ul> <p>이제 다음과 같이 레플리카셋을 생성하자.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl apply -f nginx-replicaset.yml
</code></pre></div><p>세 개의 팟이 생성된 것을 확인할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods
NAME                     READY   STATUS    RESTARTS   AGE
nginx-replicaset-6txwh   1/1     Running   0          102s
nginx-replicaset-tvsg6   1/1     Running   0          102s
nginx-replicaset-xc5xt   1/1     Running   0          102s
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>$ kubectl get replicaset
NAME               DESIRED   CURRENT   READY   AGE
nginx-replicaset   3         3         3       2m25s
</code></pre></div><p>레플리카를 다섯 개로 수정하고 <code>kubectl apply -f</code> 명령어를 다시 실행해보자.</p> <div class="language- extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre class="language-text"><code>$ kubectl get pods                  
NAME                     READY   STATUS              RESTARTS   AGE
nginx-replicaset-5xltl   1/1     Running             0          4s
nginx-replicaset-nlnsn   1/1     Running             0          4s
nginx-replicaset-6txwh   1/1     Running             0          3m44s
nginx-replicaset-tvsg6   1/1     Running             0          3m44s
nginx-replicaset-xc5xt   1/1     Running             0          3m44s
</code></pre></div><p>두 개의 팟이 추가적으로 생성되었다.</p> <h2 id="deployment"><a href="#deployment" class="header-anchor">#</a> Deployment</h2> <p><code>디플로이먼트(Deployment)</code>는 서비스와 매우 유사하다. 다만 다음 기능을 추가적으로 제공한다.</p> <ul><li>애플리케이션의 배포와 롤링 업데이트를 지원한다.</li> <li>이전 배포 버전으로 쉽게 롤백할 수 있다.</li></ul> <p>우선 디플로이먼트를 정의한 간단한 <code>nginx-deployment.yml</code> 파일을 생성하자. <code>1.10</code> 버전의 <code>nginx</code>를 사용하고 있는 것에 주목하자.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
      <span class="token key atrule">labels</span><span class="token punctuation">:</span> 
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
          <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.10</span>
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><p>이제 디플로이먼트를 생성하자. 이때 <code>--record</code> 옵션을 추가한다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl apply -f nginx-deployment.yml --record
deployment.apps/nginx-deployment created
</code></pre></div><p>디플로이먼트가 생성되었다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get deployment
NAME               READY   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3/3     3            3           116s
</code></pre></div><p>하나의 레플리카도 생성되었다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get replicaset
NAME                          DESIRED   CURRENT   READY   AGE
nginx-deployment-796dd5cd88   3         3         3       3m50s
</code></pre></div><p>세 개의 팟도 생성되었다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods
NAME                                READY   STATUS    RESTARTS   AGE
nginx-deployment-796dd5cd88-mnlpc   1/1     Running   0          105s
nginx-deployment-796dd5cd88-nsdlp   1/1     Running   0          105s
nginx-deployment-796dd5cd88-q97dp   1/1     Running   0          105s
</code></pre></div><p>지금까지는 디플로이먼트가 레플리카와 다를게 없어보인다. 이제 <code>nginx-deployment.yml</code> 파일에서 <code>nginx</code>의 버전을 <code>1.10</code>에서 <code>1.11</code>로 변경하자.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-yml"><code><span class="token comment"># 생략 ...</span>
<span class="token key atrule">containers</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
    <span class="token comment"># image: nginx: 1.10</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token key atrule">nginx</span><span class="token punctuation">:</span> <span class="token number">1.11</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><p>그 다음 <code>kubectl apply -f</code> 명령어를 다시 실행한다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl apply -f nginx-deployment.yml --record
</code></pre></div><p>팟들이 새롭게 생성된 것을 확인할 수 있다. 쿠버네티스가 각각의 팟들을 새로운 버전으로 롤링 업데이트한 것이다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods
NAME                               READY   STATUS    RESTARTS   AGE
nginx-deployment-664f4c64c-6wxxs   1/1     Running   0          32s
nginx-deployment-664f4c64c-ksdt4   1/1     Running   0          23s
nginx-deployment-664f4c64c-xz7vc   1/1     Running   0          25s
</code></pre></div><p>이제 레플리카 셋을 확인해보자. 기존 레플리카셋과 새로운 레플리카셋이 존재한다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get replicaset
NAME                          DESIRED   CURRENT   READY   AGE
nginx-deployment-664f4c64c    3         3         3       2m59s
nginx-deployment-796dd5cd88   0         0         0       10m
</code></pre></div><p>다음 명령어로 이전 버전으로 롤백을 할 수도 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl rollout undo deployment nginx-deployment --to-revision=1
deployment.apps/nginx-deployment rolled back
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods
NAME                                READY   STATUS    RESTARTS   AGE
nginx-deployment-796dd5cd88-gtmjz   1/1     Running   0          12s
nginx-deployment-796dd5cd88-m4v8v   1/1     Running   0          9s
nginx-deployment-796dd5cd88-tnh5j   1/1     Running   0          11s
</code></pre></div><h2 id="service"><a href="#service" class="header-anchor">#</a> Service</h2> <p><code>서비스(Service)</code>는 크게 세 가지 역할을 하는 오브젝트다.</p> <ul><li><p><code>팟 주소 고정</code>: 레플리카셋이나 디플로이먼트로 띄운 팟은 쿠버네티스 클러스터의 상황에 따라서 노드를 옮겨다니기도 하고 재시작되기도 한다. IP 주소가 변하기도 한다. 서비스의 <code>셀렉터(Selector)</code>, 팟의 <code>라벨(Label)</code>를 사용하면 팟이 어떤 노드에 있든 고정된 방법으로 접근할 수 있다.</p></li> <li><p><code>팟 외부 노출</code>: 컨테이너와 쿠버네티스 클러스터의 포트를 <u>바인딩</u>하고 컨테이너 포트를 외부로 노출하는 오브젝트다.  즉 서비스는 클러스터로 들어온 요청을 컨테이너로 <u>포워딩</u>해준다.</p></li> <li><p><code>로드 밸런싱</code>: 요청을 여러 팟으로 분산하여 보낸다.</p></li></ul> <p>서비스는 크게 세 가지 타입이 존재한다.</p> <table><thead><tr><th>종류</th> <th>설명</th></tr></thead> <tbody><tr><td><code>ClusterIP</code></td> <td>쿠버네티스 내부의 팟을 외부로 노출하지 않는 서비스</td></tr> <tr><td><code>NodePort</code></td> <td>쿠버네티스 내부의 포트를 외부로 노출하는 서비스. 주로 <u>온프레미스 환경</u>에서 사용한다.</td></tr> <tr><td><code>LoadBalancer</code></td> <td>AWS, GCP 등 <u>클라우드 서비스</u>에서 사용하는 서비스. 클라우드 서비스가 제공하는 로드밸런서 기능을 사용한다.</td></tr></tbody></table> <p>실제 운영 환경에서는 <code>컨테이너 외부 노출</code> 기능은 서비스 대신 <code>인그레스(Ingress)</code>를 사용하여 구축한다. 서비스는 주로 <code>팟 주소 고정</code>와 <code>로드 밸런싱</code>에 사용된다.</p> <h3 id="팟-주소-고정"><a href="#팟-주소-고정" class="header-anchor">#</a> 팟 주소 고정</h3> <p>쿠버네티스는 기본적으로 팟에 유동적으로 IP를 할당한다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods -o wide
NAME                               READY   STATUS    RESTARTS   AGE   IP         
nginx-deployment-664f4c64c-4sbfd   1/1     Running   0          6s    10.1.0.54   
nginx-deployment-664f4c64c-5r55z   1/1     Running   0          6s    10.1.0.55   
</code></pre></div><p>위 예제에서의 IP(<code>10.1.0.54</code>, <code>10.1.0.55</code>)는 쿠버네티스의 상태에 따라 동적으로 변할 수 있다. 따라서 IP가 아닌 다른 고정된 주소로 팟에 접근할 수 있어야 한다.</p> <h3 id="팟의-외부-노출"><a href="#팟의-외부-노출" class="header-anchor">#</a> 팟의 외부 노출</h3> <p>팟은 기본적으로 외부에 노출되지 않는다. 즉 쿠버네티스 클러스터 내부, 즉 <u>내부 다른 팟</u>에서만 해당 팟과 통신할 수 있다.</p> <p>이를 살펴보기 위해 두 개의 동일한 팟을 유지하는 디플로이먼트를 실행해보자.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># nginx-deployment.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
      <span class="token key atrule">labels</span><span class="token punctuation">:</span> 
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
          <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>$ kubectl apply -f nginx-deployment.yml

$ kubectl get pods -o wide
NAME                               READY   STATUS    RESTARTS   AGE   IP         
nginx-deployment-664f4c64c-4sbfd   1/1     Running   0          6s    10.1.0.54   
nginx-deployment-664f4c64c-5r55z   1/1     Running   0          6s    10.1.0.55   
</code></pre></div><p>그 다음 <code>10.1.0.54</code> 팟에 접속하여 <code>10.1.0.55</code>과 통신할 수 있는지 확인해보자.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl exec -it nginx-deployment-664f4c64c-4sbfd bash
</code></pre></div><p>팟 사이에 정상적으로 통신이 되는 것을 확인할 수 있다.</p> <div class="language- extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-text"><code>root@nginx-deployment-664f4c64c-4sbfd:/# curl 10.1.0.55
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>이제 클러스터 외부에서 접근이 안되는지 확인해보자. 쿠버네티스에서는 클러스터를 구성하는 노드 또한 외부로 간주한다. 따라서 호스트OS에서 다음 접속들은 모두 허용되지 않는다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl 10.1.0.54
$ curl 10.1.0.55
</code></pre></div><p>또한 외부 네트워크에서의 접속도 허용되지 않는다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl &lt;NODE IP&gt;
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>팟을 <u>클러스터 구성하는 노드</u>로 노출하는지는 쿠버네티스의 네트워크 모델에 따라 다르다. 일반적으로 <code>Docker Desktop for Mac OS</code>, <code>Docker Desktop for Window</code>, <code>온프레미스 모델</code>에서는 클러스터를 구성하는 노드로 조차 포드를 노출하지 않는다. 반면 일부 퍼블릭 클라우드 쿠버네티스는 별다른 설정 없이도 클러스터를 구성하는 노드에게는 포드를 노출하기도 한다. 따라서 기본적으로 <u><b>클러스터를 구성하는 노드에게 조차 팟을 노출하지 않는다</b></u>고 간주하는게 좋다.</p></div> <h3 id="clusterip-서비스"><a href="#clusterip-서비스" class="header-anchor">#</a> ClusterIP 서비스</h3> <p>서비스는 IP가 아닌 <code>셀렉터(Selector)</code>를 사용하여 팟을 식별한다. 서비스는 마치 DNS 처럼 동작하며, IP 대신 팟을 구분하는 <code>라벨(Label)</code>을 사용한다.</p> <p>서비스 생성을 위한 설정파일은 다음과 같다.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-yml"><code><span class="token comment"># nginx-service-clusterip.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service<span class="token punctuation">-</span>clusterip
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pods<span class="token punctuation">-</span>clusterip<span class="token punctuation">-</span>port
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label  <span class="token comment">## 팟의 라벨</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP  <span class="token comment">## 서비스 타입</span>
</code></pre></div><p>서비스를 생성한다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl apply -f nginx-service-clusterip.yml 
service/nginx-service-clusterip created
</code></pre></div><p>생성된 서비스는 다음과 같다.</p> <div class="language- extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br></div><pre class="language-text"><code>$ kubectl get services
NAME                      TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
kubernetes                ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP    9m47s
nginx-service-clusterip   ClusterIP   10.110.234.94   &lt;none&gt;        9999/TCP   3m30s
</code></pre></div><p>이제 다른 팟에서 서비스를 통해 팟들과 통신할 수 있다. 서비스의 <code>CLUSTER-IP</code>와 <code>PORT</code>를 사용하면 된다.</p> <div class="language- extra-class"><pre class="language-text"><code>// 다른 팟 내부에 접속
$ kubectl exec -it ubuntu-pod bash
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>// 다른 팟에서 서비스로 요청
root@ubuntu-pod:/# curl 10.110.234.94:9999
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>서비스로 요청을 보내면 로드밸런싱도 수행된다.</p> <p><img src="/blog/assets/img/2.06880b3d.png" alt=""></p> <p><code>ClusterIP</code> 타입의 서비스는 팟을 외부로 노출하지 않기 때문에 클러스터 외부 네트워크에서는 접근할 수 없다.</p> <p><img src="/blog/assets/img/3.4ce99c9b.png" alt=""></p> <h3 id="nodeport-서비스"><a href="#nodeport-서비스" class="header-anchor">#</a> NodePort 서비스</h3> <p><code>NodePort</code> 타입 서비스는 ClusterIP와 유사하다. 다만 외부 네트워크에서도 팟에 접근하도록 팟을 외부에 노출한다.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br></div><pre class="language-yml"><code><span class="token comment"># nginx-service-nodeport.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service<span class="token punctuation">-</span>nodeport
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pods<span class="token punctuation">-</span>port
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort  
</code></pre></div><p>서비스를 생성하자.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl apply -f nginx-service-nodeport.yml 
</code></pre></div><p>생성된 서비스는 다음과 같다.</p> <div class="language- extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br></div><pre class="language-text"><code>$ kubectl get services
NAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
kubernetes                ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP          49s
nginx-service-clusterip   NodePort    10.107.159.253   &lt;none&gt;        9999:30553/TCP   34s
</code></pre></div><p>클러스터 내부에서 사용되는 <code>9999</code> 포트 외에도 <code>30553</code>라는 포트가 생성됐다. <code>30553</code> 포트는 외부 네트워크로 노출되는 포트이며, 외부 네트워크에서 팟과 통신할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl &lt;워커노드 PUBLIC IP&gt;:30553
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">Info</p> <p>AWS EC2에서 쿠버네티스를 구축한 경우 보안 그룹에서 해당 포트를 개방해야한다.</p></div> <p>이제 클러스터의 노드에서도 팟과 통신할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl &lt;워커노드 PUBLIC IP&gt;:30553
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p><img src="/blog/assets/img/4.5896a52e.png" alt=""></p> <p>물론 클러스터 내부 팟에서도 여전히 통신할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>// 다른 팟 내부에 접속
$ kubectl exec -it ubuntu-pod bash
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>// 다른 팟에서 서비스로 요청
root@ubuntu-pod:/# curl 10.107.159.253:9999
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p><img src="/blog/assets/img/5.a2aacace.png" alt=""></p> <p>외부로 노출되는 포트는 기본적으로 30000~32768 포트 중 랜덤하게 선택되지만 원하면 다음과 같이 포트를 지정할 수 있다.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-yml"><code><span class="token comment"># nginx-service-nodeport.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service<span class="token punctuation">-</span>nodeport
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pods<span class="token punctuation">-</span>port
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">31000</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort  
</code></pre></div><h2 id="namespace"><a href="#namespace" class="header-anchor">#</a> Namespace</h2> <p><code>네임스페이스(Namespace)</code>를 사용하면 클러스터에서 여러 오브젝트를 논리적으로 구분할 수 있다.</p> <h3 id="네임스페이스-목록-확인"><a href="#네임스페이스-목록-확인" class="header-anchor">#</a> 네임스페이스 목록 확인</h3> <p><code>kubectl get namespaces</code> 명령어로 네임스페이스 목록을 확인할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get namespaces 
NAME              STATUS   AGE
kube-public       Active   25h
kube-system       Active   25h
default           Active   25h
</code></pre></div><p>쿠버네티스는 기본적으로 3개의 네임스페이스를 제공한다. <code>kube-public</code>와 <code>kube-system</code>는 시스템에서 사용하는 네임스페이스다. <code>default</code>는 기본으로 생성되는 네임스페이스로, 오브젝트를 생성할 때 별도의 네임스페이스를 지정하지 않으면 이 네임스페이스에 오브젝트가 생성된다.</p> <h3 id="네임스페이스-생성"><a href="#네임스페이스-생성" class="header-anchor">#</a> 네임스페이스 생성</h3> <p>다음과 같이 <code>YAML 설정 파일</code>로 네임스페이스를 생성할 수 있다.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># my-namespace.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>namespace
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>$ kubectl apply -f my_namespace.yml 
</code></pre></div><p><code>kubectl create namespace &lt;네임스페이스 이름&gt;</code> 명령어로도 네임스페이스를 생성할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl create namespace your-namespace
</code></pre></div><p>2개의 네임스페이스가 생성된 것을 확인할 수 있다.</p> <div class="language- extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-text"><code>$ kubectl get namespace 
NAME              STATUS   AGE
default           Active   25h
kube-public       Active   25h
kube-system       Active   25h
my-namespace      Active   3m35s
your-namespace    Active   52s
</code></pre></div><h3 id="네임스페이스에-오브젝트-생성하기"><a href="#네임스페이스에-오브젝트-생성하기" class="header-anchor">#</a> 네임스페이스에 오브젝트 생성하기</h3> <p>YAML 설정파일에서 <code>metadata.namespace</code> 항목을 다음과 같이 설정하면 된다.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-yml"><code><span class="token comment"># nginx-pod.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>namespace
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
</code></pre></div><h3 id="특정-네임스페이스에-포함되는-오브젝트만-조회하기"><a href="#특정-네임스페이스에-포함되는-오브젝트만-조회하기" class="header-anchor">#</a> 특정 네임스페이스에 포함되는 오브젝트만 조회하기</h3> <p><code>--all-namespaces</code> 옵션으로 네임스페이스 정보도 함께 출력할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods --all-namespaces
NAMESPACE      NAME           READY   STATUS    RESTARTS         AGE
my-namespace   nginx-pod      1/1     Running   0                5m27s
...
</code></pre></div><p><code>-n &lt;네임스페이스 이름&gt;</code> 옵션으로 특정 네임스페이스에 속하는 오브젝트만 조회할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods -n my-namespace
NAME        READY   STATUS    RESTARTS   AGE
nginx-pod   1/1     Running   0          7m45s
</code></pre></div><h3 id="네임스페이스-삭제"><a href="#네임스페이스-삭제" class="header-anchor">#</a> 네임스페이스 삭제</h3> <p><code>kubectl delete namespace &lt;네임스페이스 이름&gt;</code> 명령어로 네임스페이스를 삭제할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl create configmap my-configmap
 --from-literal NAME=paul
</code></pre></div><h2 id="configmap"><a href="#configmap" class="header-anchor">#</a> Configmap</h2> <p><code>컨피그맵(Configmap)</code>은 설정값을 저장할 수 있는 오브젝트다. 컨피그맵은 네임스페이스별로 존재한다.</p> <h3 id="컨피그맵-생성"><a href="#컨피그맵-생성" class="header-anchor">#</a> 컨피그맵 생성</h3> <p><code>kubectl create configmap &lt;이름&gt; --from-literal &lt;키=값&gt;</code>으로 컨피그맵을 생성할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl create configmap my-configmap --from-literal DB_URL=localhost
</code></pre></div><p>YAML 설정파일을 사용할 수도 있다.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># your-configmap.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> your<span class="token punctuation">-</span>configmap
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">DB_URL</span><span class="token punctuation">:</span> localhost
  <span class="token key atrule">DB_USER</span><span class="token punctuation">:</span> myuser
  <span class="token key atrule">DB_PASSWORD</span><span class="token punctuation">:</span> mypassword
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>$ kubectl apply -f your-configmap.yml
</code></pre></div><h3 id="컨피그맵-확인"><a href="#컨피그맵-확인" class="header-anchor">#</a> 컨피그맵 확인</h3> <p><code>kubectl get configmap</code>명령어로 컨피그맵을 확인할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get configmap
NAME               DATA   AGE
my-configmap       1      70s
your-configmap     3      13s
</code></pre></div><p><code>kubectl describe configmap &lt;컨피그맵 이름&gt;</code>으로 컨피그맵의 키-값을 확인할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl describe configmap your-configmap
Name:         your-configmap
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Data
====
DB_PASSWORD:
----
mypassword
DB_URL:
----
localhost
DB_USER:
----
myuser

BinaryData
====

Events:  &lt;none&gt;
</code></pre></div><h3 id="yaml-설정파일에서-컨피그맵-사용하기"><a href="#yaml-설정파일에서-컨피그맵-사용하기" class="header-anchor">#</a> YAML 설정파일에서 컨피그맵 사용하기</h3> <p>컨피그맵의 키-값은 컨테이너가 생성될 때 환경변수로 추가된다.</p> <p>이를 확인하기 위해 <code>nginx-pod.yml</code> 파일을 다음과 같이 수정하자.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
      <span class="token key atrule">envFrom</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">configMapRef</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> your<span class="token punctuation">-</span>configmap
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
</code></pre></div><p>그 다음 컨테이너를 생성하자.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl apply -f nginx-pod.yml           
pod/nginx-pod created
</code></pre></div><p>그리고 컨테이너 내부에 접속한다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl exec -it nginx-pod -c nginx-container bash
root@nginx-pod:/#
</code></pre></div><p>컨피그맵의 키-값이 컨테이너에 환경변수로 등록된 것을 확인할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>root@nginx-pod:/# echo $DB_PASSWORD
mypassword

root@nginx-pod:/# echo $DB_USER
myuser

root@nginx-pod:/# echo $DB_PASSWORD
mypassword
</code></pre></div><h3 id="컨피그맵-삭제"><a href="#컨피그맵-삭제" class="header-anchor">#</a> 컨피그맵 삭제</h3> <p><code>kubectl delete configmap &lt;컨피그맵 이름&gt;</code> 명령어로 컨피그맵을 삭제할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl delete configmap my-configmap
</code></pre></div><h2 id="secret"><a href="#secret" class="header-anchor">#</a> Secret</h2> <p><code>시크릿(Secret)</code>은 컨피그맵과 매우 유사하지만 값을 암호화하여 저장한다.</p> <h3 id="시크릿-생성"><a href="#시크릿-생성" class="header-anchor">#</a> 시크릿 생성</h3> <p><code>kubectl create secret generic &lt;시크릿 이름&gt; --from-literal &lt;키=값&gt;</code> 명령어로 시크릿을 생성한다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl create secret generic my-secret --from-literal DB_PASSWORD=1234
</code></pre></div><p>시크릿은 YAML 파일로 생성할 수도 있다.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># your-secret.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> your<span class="token punctuation">-</span>secret
<span class="token key atrule">stringData</span><span class="token punctuation">:</span>
  <span class="token key atrule">DB_URL</span><span class="token punctuation">:</span> localhost
  <span class="token key atrule">DB_USER</span><span class="token punctuation">:</span> myuser
  <span class="token key atrule">DB_PASSWORD</span><span class="token punctuation">:</span> mypass
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>$ kubectl apply -f your-secret.yml
</code></pre></div><h3 id="시크릿-확인"><a href="#시크릿-확인" class="header-anchor">#</a> 시크릿 확인</h3> <p><code>kubectl get secrets</code>명령어로 모든 시크릿을 확인할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get secrets 
NAME                  TYPE                                  DATA   AGE
default-token-jsdgt   kubernetes.io/service-account-token   3      26h
my-secret             Opaque                                1      10m
your-secret           Opaque                                3      65s
</code></pre></div><p><code>kubectl describe secret &lt;시크릿 이름&gt;</code> 명령어로 시크릿의 키-값을 확인해보자.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl describe secret your-secret
Name:         your-secret
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Type:  Opaque

Data
====
DB_PASSWORD:  6 bytes
DB_URL:       9 bytes
DB_USER:      6 bytes
</code></pre></div><p>컨피그맵과 다르게 값을 직접 출력하지 않고 바이트 수만을 보여준다. <code>kubectl get secret &lt;시크릿 이름&gt; -o yaml</code> 명령어를 사용하면 저장된 값도 확인할 수 있다.</p> <div class="language- extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-text"><code>$ kubectl get secret your-secret -o yaml
apiVersion: v1
data:
  DB_PASSWORD: bXlwYXNz
  DB_URL: bG9jYWxob3N0
  DB_USER: bXl1c2Vy
kind: Secret
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Secret&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;your-secret&quot;,&quot;namespace&quot;:&quot;default&quot;},&quot;stringData&quot;:{&quot;DB_PASSWORD&quot;:&quot;mypass&quot;,&quot;DB_URL&quot;:&quot;localhost&quot;,&quot;DB_USER&quot;:&quot;myuser&quot;}}
  creationTimestamp: &quot;2022-04-19T11:20:43Z&quot;
  name: your-secret
  namespace: default
  resourceVersion: &quot;54791&quot;
  uid: 069997e5-4ab2-4b7c-9a82-ecbb1abc5521
type: Opaque
</code></pre></div><p>시크릿은 값을 base 64로 인코딩하여 저장한다. <code>bXlwYXNz</code>, <code>bG9jYWxob3N0</code> 같이 인코딩된 값이 저장된다.</p> <h3 id="yaml-설정파일에서-시크릿-사용하기"><a href="#yaml-설정파일에서-시크릿-사용하기" class="header-anchor">#</a> YAML 설정파일에서 시크릿 사용하기</h3> <p>시크릿의 키-값 또한 컨테이너가 생성될 때 환경변수로 추가된다.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
      <span class="token key atrule">envFrom</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">secretRef</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> your<span class="token punctuation">-</span>secret
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
</code></pre></div><h3 id="시크릿-삭제"><a href="#시크릿-삭제" class="header-anchor">#</a> 시크릿 삭제</h3> <p><code>kubectl delete secret &lt;시크릿 이름&gt;</code> 명령어로 시크릿을 삭제할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl delete secret my-secret
</code></pre></div><h2 id="ingress"><a href="#ingress" class="header-anchor">#</a> Ingress</h2> <p><code>인그레스(Ingress)</code>는 크게 세 가지 기능을 제공하는 오브젝트다.</p> <ul><li>팟 외부 노출</li> <li>URL Path를 통한 포워딩</li> <li>SSL/TLS</li></ul> <h3 id="세팅"><a href="#세팅" class="header-anchor">#</a> 세팅</h3> <p>인그레스를 테스트하기 위해 다음과 같이 두 디플로이먼트를 먼저 생성한다.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment">### deployment1.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> deployment1
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> pod1<span class="token punctuation">-</span>label
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> pod1
      <span class="token key atrule">labels</span><span class="token punctuation">:</span> 
        <span class="token key atrule">app</span><span class="token punctuation">:</span> pod1<span class="token punctuation">-</span>label
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
          <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment">### deployment2.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> deployment2
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> pod2<span class="token punctuation">-</span>label
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> pod2
      <span class="token key atrule">labels</span><span class="token punctuation">:</span> 
        <span class="token key atrule">app</span><span class="token punctuation">:</span> pod2<span class="token punctuation">-</span>label
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
          <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><p>그리고 두 디플로이먼트에 대한 서비스를 생성한다.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># service1.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> service1
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> service1<span class="token punctuation">-</span>port
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">11111</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pod1<span class="token punctuation">-</span>label
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
</code></pre></div><div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># service2.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> service2
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> service2<span class="token punctuation">-</span>port
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">22222</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pod2<span class="token punctuation">-</span>label
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
</code></pre></div><p>두 서비스의 타입은 <code>ClusterIP</code>이므로 팟들이 외부에 노출되지 않는다.</p> <p><img src="/blog/assets/img/6.aa0109bf.png" alt=""></p> <h3 id="인그레스-오브젝트-생성하기"><a href="#인그레스-오브젝트-생성하기" class="header-anchor">#</a> 인그레스 오브젝트 생성하기</h3> <p>인그레스 오브젝트는 YAML 설정파일에 다음과 같이 선언한다.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># my-ingress.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>ingress
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation">:</span> <span class="token string">&quot;nginx&quot;</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span> 
  <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /service1
        <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">service</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> service1
            <span class="token key atrule">port</span><span class="token punctuation">:</span>
              <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">11111</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /service2
        <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">service</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> service2
            <span class="token key atrule">port</span><span class="token punctuation">:</span>
              <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">22222</span>
</code></pre></div><p>이제 설정파일로 인그레스 오브젝트를 생성한다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl apply -f my-ingress.yml
</code></pre></div><p><img src="/blog/assets/img/7.792d23de.png" alt=""></p> <h3 id="인그레스-컨트롤러-설치"><a href="#인그레스-컨트롤러-설치" class="header-anchor">#</a> 인그레스 컨트롤러 설치</h3> <p>인그레스 오브젝트만 생성해서는 아무 일도 일어나지 않는다. 외부 요청을 실제로 처리하는 서버가 필요하며, 이 서버를 <code>인그레스 컨트롤러</code>라고 한다. 인그레스 컨트롤러는 많은 제품군이 있으며, 여기서는 쿠버네티스 환경에서 활발히 사용되고 있는 <code>Nginx 인그레스 컨트롤러</code>를 사용해보자.</p> <p>우선 다음 명령어를 입력하여 <code>Nginx 인그레스 컨트롤러</code>를 설치한다.</p> <div class="language- extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-text"><code>$ kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.0.0/deploy/static/provider/baremetal/deploy.yaml
namespace/ingress-nginx created
serviceaccount/ingress-nginx created
configmap/ingress-nginx-controller created
clusterrole.rbac.authorization.k8s.io/ingress-nginx created
clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx created
role.rbac.authorization.k8s.io/ingress-nginx created
rolebinding.rbac.authorization.k8s.io/ingress-nginx created
service/ingress-nginx-controller-admission created
service/ingress-nginx-controller created
deployment.apps/ingress-nginx-controller created
ingressclass.networking.k8s.io/nginx created
validatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created
serviceaccount/ingress-nginx-admission created
clusterrole.rbac.authorization.k8s.io/ingress-nginx-admission created
clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created
role.rbac.authorization.k8s.io/ingress-nginx-admission created
rolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created
job.batch/ingress-nginx-admission-create created
job.batch/ingress-nginx-admission-patch created
</code></pre></div><p><code>Nginx 인그레스 컨트롤러</code>를 설치하면 관련된 여러 오브젝트가 <code>ingress-nginx</code> 네임스페이스에 자동으로 생성된다. 우선 팟과 디플로이먼트를 확인해보자. Nginx 웹 서버가 팟으로 동작하는 것을 확인할 수 있다.</p> <div class="language- extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br></div><pre class="language-text"><code>$ kubectl get pods -n ingress-nginx
NAME                                       READY   STATUS      RESTARTS   AGE
ingress-nginx-admission-create--1-x7fdd    0/1     Completed   0          4m42s
ingress-nginx-admission-patch--1-ncz4v     0/1     Completed   1          4m42s
ingress-nginx-controller-8cf5559f8-hvqkq   1/1     Running     0          4m42s
</code></pre></div><div class="language- extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br></div><pre class="language-text"><code>$ kubectl get deployments -n ingress-nginx
NAME                       READY   UP-TO-DATE   AVAILABLE   AGE
ingress-nginx-controller   1/1     1            1           5m
</code></pre></div><p>Nginx 웹 서버도 하나의 팟으로 동작하기 때문에 외부 노출을 위한 서비스가 필요하다. <code>Nginx 인그레스 컨트롤러</code>를 설치하면 필요한 서비스 또한 자동으로 생성된다.</p> <div class="language- extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-text"><code>$ kubectl get services -n ingress-nginx  
NAME                                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
ingress-nginx-controller             NodePort    10.108.230.135   &lt;none&gt;        80:32508/TCP,443:32527/TCP   5m13s
ingress-nginx-controller-admission   ClusterIP   10.96.200.134    &lt;none&gt;        443/TCP                      5m13s
</code></pre></div><p>결국 인그레스 컨트롤러는 크게 두 가지 요소로 구성된다는 것을 알 수 있다.</p> <ul><li>웹 서버 컨테이너를 내장한 <u><b>팟</b></u></li> <li>팟을 외부에 노출하고, 외부 요청을 내부로 포워딩해주는 <u><b>서비스</b></u></li></ul> <p><img src="/blog/assets/img/8.60004374.png" alt=""></p> <div class="custom-block danger"><p class="custom-block-title">DANGER</p> <p>AWS EC2에서 쿠버네티스를 구축한 경우 보안 그룹에서 해당 포트를 개방해야한다.</p></div> <p>이제 외부에서 인그레스 컨트롤러의 <code>service1</code> 서비스로 요청을 보내보자.</p> <div class="language- extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-text"><code>$ curl &lt;워커노드 PUBLIC IP&gt;:32508/service1
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p><code>service2</code>로의 요청도 처리되는 것을 확인할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl &lt;워커노드 PUBLIC IP&gt;/service2
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><h2 id="kustomize"><a href="#kustomize" class="header-anchor">#</a> Kustomize</h2> <p><b><code>Kustomize</code></b>을 사용하면 선언적, 동적으로 쿠버네티스 <code>yml</code> 설정파일을 생성할 수 있다. 예를 들어 베이스가 되는 리소스 설정파일 템플릿을 만들고, 개발 환경과 운영 환경에 따라 다른 리소스 설정파일을 구성할 수 있다.</p> <h3 id="kustomize-설치"><a href="#kustomize-설치" class="header-anchor">#</a> Kustomize 설치</h3> <p>운영체제별로 <code>Kustomize</code> 설치 방법이 다르다. <code>Ubuntu</code> 환경에서는 다음과 같이 설치할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl -s &quot;https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh&quot; | bash

$ sudo mv kustomize /usr/local/bin/

$ kustomize version
{Version:kustomize/v4.5.4 GitCommit:cf3a452ddd6f83945d39d582243b8592ec627ae3 BuildDate:2022-03-28T23:12:45Z GoOs:linux GoArch:amd64}
</code></pre></div><h3 id="예제-디렉토리-구성하기"><a href="#예제-디렉토리-구성하기" class="header-anchor">#</a> 예제 디렉토리 구성하기</h3> <p>다음과 같은 구조로 디렉토리를 생성한다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ mkdir app
$ cd
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>$ tree .
.
├── base
└── overlays
    ├── dev
    └── prod
</code></pre></div><p><code>base</code>에는 템플릿으로 사용할 리소스 설정을 생성한다. <code>overlays</code>에서는 템플릿을 사용하여 리소스 설정을 커스터마이징한다.</p> <ul><li><code>overlays/dev</code>: 개발 환경을 위한 리소스 설정이 위치하는 디렉토리</li> <li><code>overlays/prod</code>: 운영 환경을 위한 리소스 설정이 위치하는 디렉토리</li></ul> <h3 id="템플릿-생성하기"><a href="#템플릿-생성하기" class="header-anchor">#</a> 템플릿 생성하기</h3> <p><code>base</code> 디렉토리에 템플릿으로 사용할 리소스를 생성하자.</p> <div class="language- extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre class="language-text"><code>$ tree .
.
├── base
│   ├── nginx-deployment.yml
│   └── nginx-service.yml
│   └── kustomization.yml
└── overlays
    ├── dev
    └── prod
</code></pre></div><p><code>base/nginx-deployment.yml</code>는 다음과 같다.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># base/nginx-deployment.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
      <span class="token key atrule">labels</span><span class="token punctuation">:</span> 
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
          <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><p><code>base/nginx-service.yml</code>는 다음과 같다.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># base/nginx-service.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service<span class="token punctuation">-</span>nodeport
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pods<span class="token punctuation">-</span>port
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort 
</code></pre></div><p><b><code>kustomization.yml</code></b>은 <code>kustomize</code>의 핵심이 되는 파일이다. 이 파일에는 사용할 자원과 커스터마이징 방법을 나열한다.</p> <p>우선 템플릿에서 사용할 자원들을 <code>base/kustomization.yml</code>에 나열하자.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kustomize.config.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Kustomization

<span class="token key atrule">resources</span><span class="token punctuation">:</span>  <span class="token comment"># 사용할 자원들을 나열한다.</span>
<span class="token punctuation">-</span> nginx<span class="token punctuation">-</span>deployment.yml
<span class="token punctuation">-</span> nginx<span class="token punctuation">-</span>service.yml
</code></pre></div><p>이제 <code>kustomize build &lt;경로&gt;</code> 명령어를 실행해보자.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kustomize build .
</code></pre></div><p><code>base/kustomization.yml</code>을 적용하여 새롭게 생성한 리소스 설정파일이 출력된다.</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service<span class="token punctuation">-</span>nodeport
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pods<span class="token punctuation">-</span>port
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><p>다음 명령어를 사용하면 <code>kustomization.yml</code> 설정파일을 통해 리소스를 바로 생성할 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kustomize build &lt;경로&gt; | kubectl apply -f -
</code></pre></div><h3 id="개발-환경-커스터마이징"><a href="#개발-환경-커스터마이징" class="header-anchor">#</a> 개발 환경 커스터마이징</h3> <p>이제 템플릿을 사용하여 리소스 설정을 커스터마이징해보자. <code>overlays/dev</code>에 <code>kustomization.yml</code> 파일을 생성한다.</p> <div class="language- extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-text"><code>$ tree .
.
├── base
│   ├── kustomization.yml
│   ├── nginx-deployment.yml
│   └── nginx-service.yml
└── overlays
    ├── dev
    │   └── kustomization.yml
    └── prod
</code></pre></div><p><code>dev/kustomization.yml</code>는 두 가지 역할을 하고 있다.</p> <ul><li>네임스페이스를 <code>default</code>로 지정한다.</li> <li>오브젝트 이름에 접두어 <code>dev-</code>를 추가하고 있다.</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kustomize.config.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Kustomization
<span class="token key atrule">namespace</span><span class="token punctuation">:</span> default    <span class="token comment"># 네임스페이스 지정</span>
<span class="token key atrule">bases</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> ../../base          <span class="token comment"># base 디렉토리 경로 지정</span>
<span class="token key atrule">namePrefix</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>      <span class="token comment"># dev- 접두어 추가</span>
</code></pre></div><p>이제 <code>kustomize build &lt;경로&gt;</code> 명령어를 실행해보자.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kustomize build .
</code></pre></div><p>접두어와 네임스페이스가 추가된 새로운 설정 파일이 출력된다.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>service<span class="token punctuation">-</span>nodeport  <span class="token comment"># 접두어 dev 추가</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default                <span class="token comment"># 네임스페이스 추가</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pods<span class="token punctuation">-</span>port
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>deployment  <span class="token comment"># 접두어 dev- 추가</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default          <span class="token comment"># 네임스페이스 추가</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><h3 id="운영-환경-커스터마이징"><a href="#운영-환경-커스터마이징" class="header-anchor">#</a> 운영 환경 커스터마이징</h3> <p>운영 환경을 위한 <code>kustomization.yml</code> 파일을 <code>overlays/prod</code>에 구성하자.</p> <div class="language- extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br></div><pre class="language-text"><code>$ tree .
.
├── base
│   ├── kustomization.yml
│   ├── nginx-deployment.yml
│   └── nginx-service.yml
└── overlays
    ├── dev
    │   └── kustomization.yml
    └── prod
        └── kustomization.yml
</code></pre></div><p><code>prod/kustomization.yml</code>는 두 가지 역할을 하고 있다.</p> <ul><li>네임스페이스를 <code>default</code>로 지정한다.</li> <li>오브젝트 이름에 접두어 <code>prod-</code>를 추가하고 있다.</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kustomize.config.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Kustomization
<span class="token key atrule">namespace</span><span class="token punctuation">:</span> default    <span class="token comment"># 네임스페이스 지정</span>
<span class="token key atrule">bases</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> ../../base          <span class="token comment"># base 디렉토리 경로 지정</span>
<span class="token key atrule">namePrefix</span><span class="token punctuation">:</span> prod<span class="token punctuation">-</span>     <span class="token comment"># prod- 접두어 추가</span>
</code></pre></div><p>이제 <code>kustomize build &lt;경로&gt;</code> 명령어를 실행해보자.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kustomize build .
</code></pre></div><p>접두어와 네임스페이스가 추가된 새로운 설정 파일이 출력된다</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prod<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>service<span class="token punctuation">-</span>nodeport <span class="token comment"># 접두어 prod- 추가</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default                <span class="token comment"># 네임스페이스 추가</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pods<span class="token punctuation">-</span>port
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prod<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>deployment <span class="token comment"># 접두어 prod- 추가</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default          <span class="token comment"># 네임스페이스 추가</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><h3 id="이미지-태그-변경하기"><a href="#이미지-태그-변경하기" class="header-anchor">#</a> 이미지 태그 변경하기</h3> <p><code>kustomize edit set image &lt;이미지이름&gt;:&lt;태그이름&gt;</code> 명령어를 사용하면 이미지의 태그를 쉽게 변경할 수 있다.</p> <p>우선 <code>base/deployment.yml</code> 파일을 살펴보자. <code>1.0</code> 버전의 nginx 이미지를 사용하고 있다.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
      <span class="token key atrule">labels</span><span class="token punctuation">:</span> 
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
          <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.0</span>
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><p>이제 <code>overlays/dev</code>에서 <code>kustomize edit set image &lt;이미지이름&gt;:&lt;태그이름&gt;</code> 명령어를 사용하며 <code>1.2</code> 버전으로 마이그레이션한다.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kustomize edit set image nginx:1.2
</code></pre></div><p><code>overlays/dev/kustomization.yml</code>을 확인해본다. <code>1.2</code> 태그를 반영하도록 수정되어있다.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-yml"><code><span class="token comment"># overlays/dev/kustomization.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kustomize.config.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Kustomization
<span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">namePrefix</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>
<span class="token key atrule">resources</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> ../../base
<span class="token key atrule">images</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">newTag</span><span class="token punctuation">:</span> <span class="token string">&quot;1.2&quot;</span>
</code></pre></div><p>이제 <code>kustomize build .</code> 명령어를 실행해보자.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kustomize build .
</code></pre></div><div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>service<span class="token punctuation">-</span>nodeport
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pods<span class="token punctuation">-</span>port
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.2</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><h3 id="패치-파일-사용하기"><a href="#패치-파일-사용하기" class="header-anchor">#</a> 패치 파일 사용하기</h3> <p>별도의 패치 파일을 사용할 수도 있다. 우선 <code>base/deployment.yml</code> 파일을 다음과 같이 수정한다.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span> <span class="token comment">## 3개의 레플리카 사용</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
      <span class="token key atrule">labels</span><span class="token punctuation">:</span> 
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
          <span class="token comment">## image: nginx:latest &lt;&lt;&lt;&lt; 사용할 이미지를 주석 처리</span>
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><p>그리고 <code>overlays/prod</code> 디렉토리에 <code>patch.yml</code> 패치 파일을 생성한다. 이 파일은 두 가지 역할을 한다.</p> <ul><li>레플리카셋을 4개로 변경한다.</li> <li>컨테이너 이미지를 지정한다.</li></ul> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br></div><pre class="language-yml"><code><span class="token comment"># overlays/prod/patch.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">4</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
          <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.0</span>
</code></pre></div><p>이제 <code>overlays/prod/kustomization.yml</code>을 다음과 같이 수정한다.</p> <div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-yml"><code><span class="token comment"># overlays/prod/kustomization.yml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kustomize.config.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Kustomization
<span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">bases</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> ../../base
<span class="token key atrule">namePrefix</span><span class="token punctuation">:</span> prod<span class="token punctuation">-</span>
<span class="token key atrule">patchesStrategicMerge</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> patch.yml
</code></pre></div><p><code>patchesStrategicMerge</code>에 사용할 패치 파일들을 나열한다. 이 속성은 다음과 같이 동작한다.</p> <ul><li>패치파일에 선언된 속성이 템플릿 파일에 없으면 속성을 추가한다.</li> <li>패치파일에 선언된 속성이 템플릿 파일에 있으면 덮어쓴다.</li></ul> <p>이제 <code>kustomize build &lt;경로&gt;</code> 명령어로 결과물을 확인해보자.</p> <div class="language- extra-class"><pre class="language-text"><code>$ kustomize build .
</code></pre></div><div class="language-yml extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-yml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prod<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>service<span class="token punctuation">-</span>nodeport
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pods<span class="token punctuation">-</span>port
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prod<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">4</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>label
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.0</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>container
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><p>패치 파일이 적용되어 레플리카 개수가 4개로 변경되었다. 또한 컨테이너 이미지의 이름과 버전이 추가되었다.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/post/50_infra_devops/54_Kubernetes/220101_start_kubernetes.html" class="prev">
        Kubernetes 시작하기
      </a></span> <span class="next"><a href="/blog/post/50_infra_devops/54_Kubernetes/220104_kubernetes_command.html">
        Kubernetes 명령어 정리
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.32362dc0.js" defer></script><script src="/blog/assets/js/3.8795c9a2.js" defer></script><script src="/blog/assets/js/60.affca2b3.js" defer></script>
  </body>
</html>
